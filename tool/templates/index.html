<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>人材開発支援助成金 書類作成ツール</title>
    <style>
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(24px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-16px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 0 0 rgba(41,128,185,0.25); }
            50% { box-shadow: 0 0 0 10px rgba(41,128,185,0); }
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        @keyframes checkPop {
            0% { transform: scale(0); }
            60% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Hiragino Kaku Gothic ProN', 'Yu Gothic', 'Meiryo', sans-serif;
            background: linear-gradient(160deg, #e8eef5 0%, #f0f4f8 30%, #f5f0f8 70%, #eef5f0 100%);
            background-attachment: fixed;
            color: #333;
            min-height: 100vh;
            font-size: 16px;
            line-height: 1.85;
            letter-spacing: 0.04em;
        }

        .header {
            background: linear-gradient(135deg, #0f3460 0%, #1a5276 25%, #2980b9 50%, #3498db 75%, #1a5276 100%);
            background-size: 200% 200%;
            animation: gradientShift 8s ease infinite;
            color: white;
            padding: 32px 0 28px;
            text-align: center;
            box-shadow: 0 4px 24px rgba(15,52,96,0.25);
            position: relative;
            overflow: hidden;
        }
        .header::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(ellipse at 70% 20%, rgba(255,255,255,0.12) 0%, transparent 60%);
            pointer-events: none;
        }
        .header h1 {
            font-size: 1.7em;
            margin-bottom: 8px;
            letter-spacing: 0.08em;
            text-shadow: 0 2px 8px rgba(0,0,0,0.2);
            position: relative;
        }
        .header p {
            font-size: 1em;
            opacity: 0.92;
            letter-spacing: 0.06em;
            position: relative;
        }

        .container {
            width: 80%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 28px 0;
        }

        /* Progress Bar */
        .progress-bar {
            display: flex;
            justify-content: space-between;
            margin: 24px 0 36px;
            position: relative;
            background: rgba(255,255,255,0.7);
            backdrop-filter: blur(8px);
            border-radius: 16px;
            padding: 18px 12px 14px;
            box-shadow: 0 2px 16px rgba(0,0,0,0.06);
        }
        .progress-bar::before {
            content: '';
            position: absolute;
            top: 33px;
            left: 6%;
            right: 6%;
            height: 3px;
            background: linear-gradient(90deg, #dde4ec, #d0d8e4);
            z-index: 0;
            border-radius: 2px;
        }
        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 1;
            cursor: pointer;
            flex: 1;
            transition: transform 0.25s ease;
        }
        .progress-step:hover { transform: translateY(-2px); }
        .progress-step .circle {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            background: linear-gradient(135deg, #dde4ec, #c8d0dc);
            color: #999;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 15px;
            font-weight: bold;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .progress-step.active .circle {
            background: linear-gradient(135deg, #2980b9, #3498db);
            color: white;
            box-shadow: 0 4px 16px rgba(41,128,185,0.4);
            animation: pulseGlow 2s ease-in-out infinite;
        }
        .progress-step.completed .circle {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            box-shadow: 0 3px 12px rgba(39,174,96,0.35);
            animation: checkPop 0.4s ease forwards;
        }
        .progress-step .label {
            font-size: 12px;
            margin-top: 8px;
            text-align: center;
            color: #999;
            letter-spacing: 0.03em;
            transition: all 0.3s;
        }
        .progress-step.active .label { color: #2980b9; font-weight: bold; }
        .progress-step.completed .label { color: #27ae60; font-weight: bold; }

        /* Step Panels */
        .step-panel {
            background: rgba(255,255,255,0.92);
            backdrop-filter: blur(12px);
            border-radius: 16px;
            padding: 40px 44px;
            box-shadow: 0 4px 32px rgba(0,0,0,0.07), 0 1px 4px rgba(0,0,0,0.04);
            display: none;
            border: 1px solid rgba(255,255,255,0.6);
        }
        .step-panel.active {
            display: block;
            animation: fadeInUp 0.45s ease-out;
        }
        .step-panel h2 {
            font-size: 1.45em;
            background: linear-gradient(135deg, #0f3460, #1a5276);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
            padding-bottom: 14px;
            border-bottom: 2px solid transparent;
            border-image: linear-gradient(90deg, #2980b9, #3498db, transparent) 1;
            letter-spacing: 0.05em;
        }
        .step-panel .desc {
            color: #666;
            font-size: 0.95em;
            margin-bottom: 24px;
            line-height: 1.8;
        }

        /* Form Groups */
        .form-group {
            margin-bottom: 22px;
            animation: slideIn 0.3s ease-out;
        }
        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 0.95em;
            color: #3a3f47;
            letter-spacing: 0.03em;
        }
        .form-group label .required {
            color: #e74c3c;
            font-size: 0.85em;
            margin-left: 4px;
        }
        .form-group label .hint {
            color: #8899a6;
            font-size: 0.85em;
            font-weight: normal;
            display: block;
            margin-top: 4px;
            line-height: 1.7;
        }

        /* Input Fields */
        input[type="text"], input[type="number"], input[type="email"],
        select, textarea {
            width: 100%;
            padding: 13px 16px;
            border: 2px solid #dde4ec;
            border-radius: 10px;
            font-size: 16px;
            line-height: 1.6;
            letter-spacing: 0.03em;
            transition: all 0.35s ease;
            font-family: inherit;
            background: rgba(255,255,255,0.85);
        }
        input:focus, select:focus, textarea:focus {
            border-color: #2980b9;
            outline: none;
            box-shadow: 0 0 0 4px rgba(41,128,185,0.12);
            background: #fff;
        }
        input:hover, select:hover, textarea:hover {
            border-color: #b0c4d8;
        }
        textarea {
            resize: vertical;
            min-height: 120px;
        }

        /* Inline Groups */
        .inline-group {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }
        .inline-group .form-group { flex: 1; }
        .inline-group .separator {
            padding: 12px 6px;
            font-size: 1.3em;
            color: #8899a6;
        }

        /* Radio & Checkbox */
        .radio-group, .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }
        .radio-option, .checkbox-option {
            flex: 1;
            min-width: 200px;
        }
        .radio-option label, .checkbox-option label {
            display: flex;
            align-items: center;
            padding: 14px 18px;
            border: 2px solid #dde4ec;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: normal;
            font-size: 0.95em;
            letter-spacing: 0.02em;
            background: rgba(255,255,255,0.6);
        }
        .radio-option label:hover, .checkbox-option label:hover {
            border-color: #a8c4db;
            background: rgba(234,242,248,0.5);
            transform: translateY(-1px);
            box-shadow: 0 3px 12px rgba(0,0,0,0.05);
        }
        .radio-option input:checked + label,
        .checkbox-option input:checked + label {
            border-color: #2980b9;
            background: linear-gradient(135deg, #eaf2f8, #dbeaf5);
            box-shadow: 0 2px 12px rgba(41,128,185,0.12);
        }
        .radio-option input, .checkbox-option input {
            display: none;
        }
        .radio-option label::before {
            content: '';
            width: 20px;
            height: 20px;
            border: 2px solid #ccc;
            border-radius: 50%;
            margin-right: 10px;
            flex-shrink: 0;
            transition: all 0.3s ease;
            background: #fff;
        }
        .radio-option input:checked + label::before {
            border-color: #2980b9;
            background: radial-gradient(circle at center, #2980b9 40%, #fff 45%);
            box-shadow: 0 0 0 3px rgba(41,128,185,0.15);
        }

        /* Buttons */
        .btn-row {
            display: flex;
            justify-content: space-between;
            margin-top: 36px;
            padding-top: 24px;
            border-top: 1px solid #eef2f6;
        }
        .btn {
            padding: 14px 36px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.35s cubic-bezier(0.34, 1, 0.64, 1);
            font-family: inherit;
            letter-spacing: 0.04em;
            position: relative;
            overflow: hidden;
        }
        .btn::after {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            width: 0; height: 0;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            transition: width 0.5s, height 0.5s, top 0.5s, left 0.5s;
        }
        .btn:active::after {
            width: 300px; height: 300px;
            top: -100px; left: -100px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #2980b9, #3498db);
            color: white;
            box-shadow: 0 4px 16px rgba(41,128,185,0.3);
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #2471a3, #2980b9);
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(41,128,185,0.4);
        }
        .btn-secondary {
            background: linear-gradient(135deg, #eef2f6, #e0e6ee);
            color: #5a6370;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        .btn-secondary:hover {
            background: linear-gradient(135deg, #e0e6ee, #d4dce6);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .btn-success {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            font-size: 1.15em;
            padding: 18px 48px;
            box-shadow: 0 4px 20px rgba(39,174,96,0.35);
        }
        .btn-success:hover {
            background: linear-gradient(135deg, #229954, #27ae60);
            transform: translateY(-2px);
            box-shadow: 0 8px 28px rgba(39,174,96,0.4);
        }

        /* Worker Entries */
        .worker-entry {
            background: linear-gradient(135deg, #f8f9fb, #f0f3f7);
            border: 1px solid #e4e9ef;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 14px;
            transition: all 0.3s ease;
        }
        .worker-entry:hover {
            box-shadow: 0 3px 16px rgba(0,0,0,0.06);
            border-color: #d0d8e2;
        }
        .worker-entry h4 {
            color: #2980b9;
            margin-bottom: 14px;
            font-size: 1.05em;
            letter-spacing: 0.03em;
        }
        .btn-add-worker {
            background: linear-gradient(135deg, #eaf2f8, #dbeaf5);
            color: #2980b9;
            border: 2px dashed #a8c4db;
            border-radius: 10px;
            padding: 16px;
            width: 100%;
            cursor: pointer;
            font-size: 15px;
            font-family: inherit;
            font-weight: bold;
            letter-spacing: 0.03em;
            transition: all 0.3s ease;
        }
        .btn-add-worker:hover {
            background: linear-gradient(135deg, #d4e6f1, #c5dced);
            border-color: #2980b9;
            transform: translateY(-1px);
        }
        .btn-remove {
            background: linear-gradient(135deg, #fde8e8, #fad4d4);
            color: #e74c3c;
            border: none;
            border-radius: 6px;
            padding: 6px 14px;
            cursor: pointer;
            font-size: 13px;
            float: right;
            transition: all 0.3s;
            font-weight: bold;
        }
        .btn-remove:hover {
            background: linear-gradient(135deg, #fad4d4, #f5bfbf);
            transform: translateY(-1px);
        }

        /* Conditionals */
        .conditional { display: none; }
        .conditional.show { display: block; animation: fadeInUp 0.35s ease-out; }

        /* Results */
        .result-panel {
            text-align: center;
            padding: 48px 24px;
            animation: fadeInUp 0.5s ease-out;
        }
        .result-panel .icon {
            font-size: 4.5em;
            margin-bottom: 18px;
            animation: checkPop 0.5s ease-out;
        }
        .result-panel h2 {
            margin-bottom: 18px;
            -webkit-text-fill-color: unset;
            background: none;
            color: #1a5276;
        }
        .file-list {
            text-align: left;
            background: linear-gradient(135deg, #f8f9fb, #f0f3f7);
            border-radius: 12px;
            padding: 24px;
            margin: 24px 0;
            border: 1px solid #e4e9ef;
        }
        .file-list li {
            padding: 10px 0;
            list-style: none;
            border-bottom: 1px solid #e8ecf0;
            font-size: 0.95em;
            letter-spacing: 0.02em;
            transition: all 0.2s;
        }
        .file-list li:hover {
            padding-left: 6px;
            color: #1a5276;
        }
        .file-list li:last-child { border-bottom: none; }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 48px;
        }
        .loading .spinner {
            width: 56px;
            height: 56px;
            border: 4px solid #e4e9ef;
            border-top-color: #2980b9;
            border-right-color: #3498db;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 20px;
        }
        .loading p {
            font-size: 1.05em;
            color: #5a6370;
            letter-spacing: 0.04em;
        }

        /* Dividers & Info */
        .section-divider {
            border: none;
            border-top: 2px solid #eef2f6;
            margin: 30px 0;
        }
        .info-box {
            background: linear-gradient(135deg, #eaf2f8, #dbeaf5);
            border-left: 4px solid #2980b9;
            padding: 16px 20px;
            margin-bottom: 22px;
            border-radius: 0 10px 10px 0;
            font-size: 0.92em;
            color: #4a5568;
            line-height: 1.8;
            box-shadow: 0 2px 8px rgba(41,128,185,0.08);
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 28px 0 36px;
            color: #8899a6;
            font-size: 0.85em;
            letter-spacing: 0.03em;
        }

        /* Responsive */
        @media (max-width: 900px) {
            .container { width: 92%; padding: 16px 0; }
            .step-panel { padding: 28px 24px; }
        }
        @media (max-width: 600px) {
            .container { width: 96%; padding: 10px 0; }
            .step-panel { padding: 24px 18px; }
            .inline-group { flex-direction: column; }
            .progress-step .label { font-size: 10px; }
            .progress-step .circle { width: 32px; height: 32px; font-size: 13px; }
            .header h1 { font-size: 1.3em; }
            body { font-size: 15px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>人材開発支援助成金 書類作成ツール</h1>
        <p>事業展開等リスキリング支援コース - 質問に答えるだけで全書類が完成します</p>
    </div>

    <div class="container">
        <div class="progress-bar" id="progressBar">
            <div class="progress-step active" onclick="goToStep(0)">
                <div class="circle">1</div>
                <div class="label">基本情報</div>
            </div>
            <div class="progress-step" onclick="goToStep(1)">
                <div class="circle">2</div>
                <div class="label">事業所</div>
            </div>
            <div class="progress-step" onclick="goToStep(2)">
                <div class="circle">3</div>
                <div class="label">訓練概要</div>
            </div>
            <div class="progress-step" onclick="goToStep(3)">
                <div class="circle">4</div>
                <div class="label">事業展開</div>
            </div>
            <div class="progress-step" onclick="goToStep(4)">
                <div class="circle">5</div>
                <div class="label">訓練詳細</div>
            </div>
            <div class="progress-step" onclick="goToStep(5)">
                <div class="circle">6</div>
                <div class="label">対象労働者</div>
            </div>
            <div class="progress-step" onclick="goToStep(6)">
                <div class="circle">7</div>
                <div class="label">経費情報</div>
            </div>
            <div class="progress-step" onclick="goToStep(7)">
                <div class="circle">8</div>
                <div class="label">確認・生成</div>
            </div>
        </div>

        <!-- STEP 1: 基本情報 -->
        <div class="step-panel active" id="step0">
            <h2>Step 1: 基本情報</h2>
            <p class="desc">申請する事業主（会社）の基本情報を入力してください</p>

            <div class="info-box">
                ここで入力する情報は全ての書類に共通で使用されます。正確に入力してください。
            </div>

            <div class="inline-group">
                <div class="form-group">
                    <label>提出日（年）<span class="required">*</span>
                        <span class="hint">西暦で入力（例：2026）</span></label>
                    <input type="number" id="submit_year" value="2026" min="2024" max="2030">
                </div>
                <div class="separator">/</div>
                <div class="form-group">
                    <label>月<span class="required">*</span></label>
                    <input type="number" id="submit_month" min="1" max="12">
                </div>
                <div class="separator">/</div>
                <div class="form-group">
                    <label>日<span class="required">*</span></label>
                    <input type="number" id="submit_day" min="1" max="31">
                </div>
            </div>

            <div class="form-group">
                <label>提出先の労働局<span class="required">*</span>
                    <span class="hint">事業所の所在地を管轄する労働局名（例：東京）</span></label>
                <input type="text" id="labor_bureau" placeholder="例：東京">
            </div>

            <hr class="section-divider">

            <div class="inline-group">
                <div class="form-group">
                    <label>事業主 郵便番号<span class="required">*</span></label>
                    <input type="text" id="postal_code_1" placeholder="100" maxlength="3">
                </div>
                <div class="separator">-</div>
                <div class="form-group">
                    <label>&nbsp;</label>
                    <input type="text" id="postal_code_2" placeholder="8916" maxlength="4">
                </div>
            </div>

            <div class="form-group">
                <label>事業主 所在地<span class="required">*</span>
                    <span class="hint">都道府県から番地まで正確に入力</span></label>
                <input type="text" id="company_address" placeholder="例：東京都千代田区霞が関１−０−０">
            </div>

            <div class="form-group">
                <label>申請者の種別<span class="required">*</span></label>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" name="applicant_type" id="applicant_corp" value="corporate" checked>
                        <label for="applicant_corp">法人（株式会社・合同会社等）</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="applicant_type" id="applicant_individual" value="individual">
                        <label for="applicant_individual">個人事業主</label>
                    </div>
                </div>
            </div>

            <div class="form-group" id="company_name_group">
                <label><span id="company_name_label">事業主 名称（会社名）</span><span class="required">*</span></label>
                <input type="text" id="company_name" placeholder="例：株式会社○○">
            </div>

            <div class="inline-group" id="representative_group">
                <div class="form-group">
                    <label id="rep_title_label">代表者 役職名</label>
                    <input type="text" id="representative_title" placeholder="例：代表取締役">
                </div>
                <div class="form-group">
                    <label>代表者 氏名<span class="required">*</span></label>
                    <input type="text" id="representative_name" placeholder="例：山田 太郎">
                </div>
            </div>

            <div class="form-group conditional show" id="corporate_number_group">
                <label>法人番号（13桁）
                    <span class="hint">法人の場合のみ。国税庁の法人番号公表サイトで確認できます</span></label>
                <input type="text" id="corporate_number" placeholder="1234567890123" maxlength="13">
            </div>

            <hr class="section-divider">

            <div class="form-group">
                <label>社会保険労務士・代理人に依頼していますか？</label>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" name="has_agent" id="has_agent_no" value="no" checked>
                        <label for="has_agent_no">いいえ（自社で提出）</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="has_agent" id="has_agent_yes" value="yes">
                        <label for="has_agent_yes">はい</label>
                    </div>
                </div>
            </div>

            <div class="conditional" id="agent_section">
                <div class="info-box">代理人・社会保険労務士の情報を入力してください</div>
                <div class="form-group">
                    <label>提出の種類</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" name="agent_type" id="agent_type_1" value="代行" checked>
                            <label for="agent_type_1">提出代行者</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" name="agent_type" id="agent_type_2" value="代理">
                            <label for="agent_type_2">事務代理者</label>
                        </div>
                    </div>
                </div>
                <div class="inline-group">
                    <div class="form-group">
                        <label>郵便番号</label>
                        <input type="text" id="agent_postal_1" maxlength="3">
                    </div>
                    <div class="separator">-</div>
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <input type="text" id="agent_postal_2" maxlength="4">
                    </div>
                </div>
                <div class="form-group">
                    <label>所在地</label>
                    <input type="text" id="agent_address">
                </div>
                <div class="form-group">
                    <label>名称（事務所名）</label>
                    <input type="text" id="agent_name_org">
                </div>
                <div class="form-group">
                    <label>氏名</label>
                    <input type="text" id="agent_name_person">
                </div>
                <div class="inline-group">
                    <div class="form-group">
                        <label>電話番号</label>
                        <input type="text" id="agent_phone_1" placeholder="03" maxlength="4">
                    </div>
                    <div class="separator">-</div>
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <input type="text" id="agent_phone_2" maxlength="4">
                    </div>
                    <div class="separator">-</div>
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <input type="text" id="agent_phone_3" maxlength="4">
                    </div>
                </div>
            </div>

            <div class="btn-row">
                <div></div>
                <button class="btn btn-primary" onclick="nextStep()">次へ →</button>
            </div>
        </div>

        <!-- STEP 2: 事業所情報 -->
        <div class="step-panel" id="step1">
            <h2>Step 2: 雇用保険適用事業所の情報</h2>
            <p class="desc">訓練を実施する事業所の情報を入力してください</p>

            <div class="form-group">
                <label>雇用保険適用事業所の名称<span class="required">*</span>
                    <span class="hint">本社名と異なる場合は事業所名を入力</span></label>
                <input type="text" id="office_name" placeholder="例：株式会社○○ 本社">
            </div>

            <div class="inline-group">
                <div class="form-group">
                    <label>雇用保険適用事業所番号<span class="required">*</span>
                        <span class="hint">4桁-6桁-1桁</span></label>
                    <input type="text" id="office_number_1" placeholder="1301" maxlength="4">
                </div>
                <div class="separator">-</div>
                <div class="form-group">
                    <label>&nbsp;</label>
                    <input type="text" id="office_number_2" placeholder="000000" maxlength="6">
                </div>
                <div class="separator">-</div>
                <div class="form-group" style="max-width:80px">
                    <label>&nbsp;</label>
                    <input type="text" id="office_number_3" placeholder="0" maxlength="1">
                </div>
            </div>

            <div class="inline-group">
                <div class="form-group">
                    <label>事業所 郵便番号</label>
                    <input type="text" id="office_postal_1" maxlength="3">
                </div>
                <div class="separator">-</div>
                <div class="form-group">
                    <label>&nbsp;</label>
                    <input type="text" id="office_postal_2" maxlength="4">
                </div>
            </div>

            <div class="form-group">
                <label>事業所 所在地<span class="required">*</span></label>
                <input type="text" id="office_address">
            </div>

            <hr class="section-divider">

            <div class="inline-group">
                <div class="form-group">
                    <label>担当者 氏名<span class="required">*</span></label>
                    <input type="text" id="contact_name" placeholder="例：田中 花子">
                </div>
                <div class="form-group">
                    <label>担当者 所属・役職</label>
                    <input type="text" id="contact_dept" placeholder="例：総務部 総務課長">
                </div>
            </div>

            <div class="inline-group">
                <div class="form-group">
                    <label>担当者 電話番号<span class="required">*</span></label>
                    <input type="text" id="contact_phone_1" maxlength="4">
                </div>
                <div class="separator">-</div>
                <div class="form-group">
                    <label>&nbsp;</label>
                    <input type="text" id="contact_phone_2" maxlength="4">
                </div>
                <div class="separator">-</div>
                <div class="form-group">
                    <label>&nbsp;</label>
                    <input type="text" id="contact_phone_3" maxlength="4">
                </div>
            </div>

            <div class="form-group">
                <label>担当者 メールアドレス</label>
                <input type="email" id="contact_email" placeholder="example@company.co.jp">
            </div>

            <hr class="section-divider">

            <div class="form-group">
                <label>企業全体で常時雇用する労働者数<span class="required">*</span>
                    <span class="hint">中小企業の判定に使用されます</span></label>
                <input type="number" id="total_employees" placeholder="例：50">
            </div>

            <div class="form-group">
                <label>中小企業事業主に該当しますか？<span class="required">*</span>
                    <span class="hint">業種により基準が異なります。不明な場合は労働局にご確認ください</span></label>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" name="is_sme" id="is_sme_yes" value="yes" checked>
                        <label for="is_sme_yes">はい（中小企業）</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="is_sme" id="is_sme_no" value="no">
                        <label for="is_sme_no">いいえ（大企業）</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>主たる事業<span class="required">*</span>
                    <span class="hint">日本標準産業分類の大分類（例：情報通信業、製造業、サービス業）</span></label>
                <input type="text" id="main_business" placeholder="例：情報通信業">
            </div>

            <div class="btn-row">
                <button class="btn btn-secondary" onclick="prevStep()">← 戻る</button>
                <button class="btn btn-primary" onclick="nextStep()">次へ →</button>
            </div>
        </div>

        <!-- STEP 3: 訓練概要 -->
        <div class="step-panel" id="step2">
            <h2>Step 3: 訓練の概要</h2>
            <p class="desc">実施する訓練の基本情報を入力してください</p>

            <div class="form-group">
                <label>助成区分<span class="required">*</span>
                    <span class="hint">訓練の目的に合わせて選択してください</span></label>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" name="subsidy_type" id="subsidy_1" value="1">
                        <label for="subsidy_1">事業展開に伴い実施する訓練</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="subsidy_type" id="subsidy_2" value="2" checked>
                        <label for="subsidy_2">DX化に伴い実施する訓練</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="subsidy_type" id="subsidy_3" value="3">
                        <label for="subsidy_3">グリーン・カーボンニュートラル化に伴い実施する訓練</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>定額制サービス（サブスクリプション型）による訓練ですか？<span class="required">*</span></label>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" name="is_subscription" id="sub_no" value="no" checked>
                        <label for="sub_no">いいえ（通常の訓練）</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="is_subscription" id="sub_yes" value="yes">
                        <label for="sub_yes">はい（定額制サービス）</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>訓練コースの名称<span class="required">*</span>
                    <span class="hint">受講する訓練の正式名称</span></label>
                <input type="text" id="course_name" value="AI人材育成プラン" placeholder="例：データサイエンティスト育成コース">
            </div>

            <div class="form-group">
                <label>受講（予定）者数<span class="required">*</span></label>
                <input type="number" id="num_trainees" placeholder="例：5" min="1">
            </div>

            <div class="info-box">訓練の実施期間を入力してください（開始日〜終了日）</div>
            <div class="inline-group">
                <div class="form-group">
                    <label>開始日（年）</label>
                    <input type="number" id="training_start_year" min="2024" max="2030">
                </div>
                <div class="form-group">
                    <label>月</label>
                    <input type="number" id="training_start_month" min="1" max="12">
                </div>
                <div class="form-group">
                    <label>日</label>
                    <input type="number" id="training_start_day" min="1" max="31">
                </div>
                <div class="separator">〜</div>
                <div class="form-group">
                    <label>終了日（年）</label>
                    <input type="number" id="training_end_year" min="2024" max="2030">
                </div>
                <div class="form-group">
                    <label>月</label>
                    <input type="number" id="training_end_month" min="1" max="12">
                </div>
                <div class="form-group">
                    <label>日</label>
                    <input type="number" id="training_end_day" min="1" max="31">
                </div>
            </div>

            <div class="conditional" id="subscription_section">
                <hr class="section-divider">
                <div class="info-box">定額制サービスの契約期間を入力してください</div>
                <div class="inline-group">
                    <div class="form-group">
                        <label>契約開始日（年）</label>
                        <input type="number" id="contract_start_year">
                    </div>
                    <div class="form-group">
                        <label>月</label>
                        <input type="number" id="contract_start_month">
                    </div>
                    <div class="form-group">
                        <label>日</label>
                        <input type="number" id="contract_start_day">
                    </div>
                    <div class="separator">〜</div>
                    <div class="form-group">
                        <label>契約終了日（年）</label>
                        <input type="number" id="contract_end_year">
                    </div>
                    <div class="form-group">
                        <label>月</label>
                        <input type="number" id="contract_end_month">
                    </div>
                    <div class="form-group">
                        <label>日</label>
                        <input type="number" id="contract_end_day">
                    </div>
                </div>
                <div class="form-group">
                    <label>契約は自動更新ですか？</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" name="auto_renewal" id="renewal_no" value="no" checked>
                            <label for="renewal_no">いいえ</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" name="auto_renewal" id="renewal_yes" value="yes">
                            <label for="renewal_yes">はい</label>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>契約者数（総受講者数）</label>
                    <input type="number" id="total_subscribers">
                </div>
            </div>

            <hr class="section-divider">

            <div class="form-group">
                <label>訓練の実施方法<span class="required">*</span></label>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" name="training_method" id="method_1" value="1">
                        <label for="method_1">通学制</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="training_method" id="method_2" value="2" checked>
                        <label for="method_2">同時双方向型（オンライン）</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="training_method" id="method_3" value="3">
                        <label for="method_3">eラーニング</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="training_method" id="method_4" value="4">
                        <label for="method_4">通信制</label>
                    </div>
                </div>
            </div>

            <div class="conditional" id="hours_classroom">
                <div class="inline-group">
                    <div class="form-group">
                        <label>総訓練時間数<span class="required">*</span></label>
                        <input type="number" id="total_hours" value="10" placeholder="例：150">
                    </div>
                    <div class="form-group" style="max-width: 100px">
                        <label>分</label>
                        <input type="number" id="total_minutes" value="0" max="59">
                    </div>
                </div>
                <div class="inline-group">
                    <div class="form-group">
                        <label>OFF-JT実訓練時間数<span class="required">*</span>
                            <span class="hint">総訓練時間数から休憩・移動等を除いた時間</span></label>
                        <input type="number" id="offjt_hours" value="10" placeholder="例：150">
                    </div>
                    <div class="form-group" style="max-width: 100px">
                        <label>分</label>
                        <input type="number" id="offjt_minutes" value="0" max="59">
                    </div>
                </div>
            </div>

            <div class="conditional" id="hours_elearning">
                <div class="inline-group">
                    <div class="form-group">
                        <label>標準学習時間<span class="required">*</span></label>
                        <input type="number" id="standard_hours" placeholder="例：100">
                    </div>
                    <div class="form-group" style="max-width: 100px">
                        <label>分</label>
                        <input type="number" id="standard_minutes" value="0" max="59">
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>資格試験を受験しますか？</label>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" name="has_exam" id="exam_no" value="no" checked>
                        <label for="exam_no">いいえ</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="has_exam" id="exam_yes" value="yes">
                        <label for="exam_yes">はい</label>
                    </div>
                </div>
            </div>

            <div class="conditional" id="exam_section">
                <div class="form-group">
                    <label>資格試験名</label>
                    <input type="text" id="exam_name">
                </div>
                <div class="inline-group">
                    <div class="form-group">
                        <label>受験日（年）</label>
                        <input type="number" id="exam_year">
                    </div>
                    <div class="form-group">
                        <label>月</label>
                        <input type="number" id="exam_month">
                    </div>
                    <div class="form-group">
                        <label>日</label>
                        <input type="number" id="exam_day">
                    </div>
                </div>
            </div>

            <div class="btn-row">
                <button class="btn btn-secondary" onclick="prevStep()">← 戻る</button>
                <button class="btn btn-primary" onclick="nextStep()">次へ →</button>
            </div>
        </div>

        <!-- STEP 4: 事業展開計画 -->
        <div class="step-panel" id="step3">
            <h2>Step 4: 事業展開等実施計画</h2>
            <p class="desc">事業展開の内容を具体的に記述してください（様式第1-3号に使用）</p>

            <div class="conditional show" id="expansion_section">
                <div class="form-group">
                    <label>事業展開の実施（予定）時期<span class="required">*</span></label>
                    <div class="inline-group">
                        <div class="form-group">
                            <input type="number" id="expansion_year" placeholder="2026">
                        </div>
                        <div class="separator">年</div>
                        <div class="form-group">
                            <input type="number" id="expansion_month" placeholder="10" min="1" max="12">
                        </div>
                        <div class="separator">月（予定）</div>
                    </div>
                </div>

                <div class="form-group" id="expansion_content_group" style="display:none">
                    <label>事業展開の内容<span class="required">*</span>
                        <span class="hint">現在の事業内容と、訓練を行う端緒となる事業展開の内容を具体的に記載してください</span></label>
                    <textarea id="expansion_content" rows="8" placeholder="例：現在は○○部品を中心とする製造業を営んでいるが、今後の半導体の需要増を見据え、半導体工場の建設を予定しており、工場の設備や生産ラインの安定した運用を図るため、各種自動制御技術、電気保全技術、空圧装置制御技術等を習得する訓練を従業員に受講させたい。"></textarea>
                </div>

                <div class="form-group" id="dx_content_group">
                    <label>DX化又はグリーン・カーボンニュートラル化の内容<span class="required">*</span>
                        <span class="hint">訓練を行う端緒となるDX化等の内容を具体的に記載してください</span></label>
                    <textarea id="dx_content" rows="8" placeholder="例：建設業において、DX化による測量受注の拡大を受けて、ドローンやBIMを活用した測量作業に習熟した従業員の育成を目指し、ドローンの操縦技能やBIMの講習を受講させたい。">業務のDX化推進のため、生成AI（ChatGPT等）を活用した業務効率化・自動化を図る必要があり、従業員にAIツールの選定・導入方法、プロンプトエンジニアリング、業務プロセスへのAI組み込み手法等を習得させるため、外部のAI人材育成研修を受講させたい。</textarea>
                </div>
            </div>

            <div class="btn-row">
                <button class="btn btn-secondary" onclick="prevStep()">← 戻る</button>
                <button class="btn btn-primary" onclick="nextStep()">次へ →</button>
            </div>
        </div>

        <!-- STEP 5: 訓練詳細 -->
        <div class="step-panel" id="step4">
            <h2>Step 5: 訓練の詳細</h2>
            <p class="desc">訓練の実施形態と教育訓練機関の情報を入力してください</p>

            <div class="form-group">
                <label>訓練の実施場所<span class="required">*</span></label>
                <input type="text" id="training_location" value="オンライン（Zoom等を使用した同時双方向型通信訓練）送信元：秋田県秋田市手形字西谷地177-2" placeholder="例：株式会社○○ 東京都渋谷区○○ / オンライン">
            </div>

            <div class="form-group">
                <label>OFF-JT訓練の種別<span class="required">*</span></label>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" name="offjt_type" id="offjt_1" value="1">
                        <label for="offjt_1">事業内訓練（部内講師）</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="offjt_type" id="offjt_2" value="2">
                        <label for="offjt_2">事業内訓練（部外講師）</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="offjt_type" id="offjt_3" value="3" checked>
                        <label for="offjt_3">事業外訓練</label>
                    </div>
                </div>
            </div>

            <div class="conditional" id="internal_instructor">
                <div class="form-group">
                    <label>講師の氏名</label>
                    <input type="text" id="instructor_name">
                </div>
                <div class="form-group">
                    <label>講師の所属部署</label>
                    <input type="text" id="instructor_dept">
                </div>
                <div class="form-group">
                    <label>講師の役職</label>
                    <input type="text" id="instructor_title">
                </div>
                <div class="form-group">
                    <label>講師の主な業務</label>
                    <input type="text" id="instructor_duties">
                </div>
            </div>

            <div class="conditional show" id="external_training">
                <hr class="section-divider">
                <div class="info-box">教育訓練機関（スクール・研修会社等）の情報を入力してください</div>
                <div class="form-group">
                    <label>教育訓練機関の名称<span class="required">*</span></label>
                    <input type="text" id="training_org_name" value="if(塾)" placeholder="例：株式会社○○スクール">
                </div>
                <div class="form-group">
                    <label>教育訓練機関の代表者名</label>
                    <input type="text" id="training_org_rep" value="高崎翔太">
                </div>
                <div class="form-group">
                    <label>教育訓練機関の所在地</label>
                    <input type="text" id="training_org_address" value="秋田県秋田市手形字西谷地177-2">
                </div>
                <div class="form-group">
                    <label>教育訓練機関の法人番号（支給申請承諾書用）</label>
                    <input type="text" id="training_org_corp_number" maxlength="13">
                </div>
                <div class="form-group">
                    <label>訓練契約を締結した経緯</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" name="contract_reason" id="reason_1" value="1">
                            <label for="reason_1">訓練実施に関する営業を受けた</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" name="contract_reason" id="reason_2" value="2" checked>
                            <label for="reason_2">自ら検索して見つけた</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" name="contract_reason" id="reason_3" value="3">
                            <label for="reason_3">その他</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="btn-row">
                <button class="btn btn-secondary" onclick="prevStep()">← 戻る</button>
                <button class="btn btn-primary" onclick="nextStep()">次へ →</button>
            </div>
        </div>

        <!-- STEP 6: 対象労働者 -->
        <div class="step-panel" id="step5">
            <h2>Step 6: 対象労働者の情報</h2>
            <p class="desc">訓練を受講する労働者の情報を入力してください</p>

            <div class="info-box">
                雇用保険被保険者番号は「資格取得等確認通知書」等でご確認ください。（4桁-6桁-1桁の形式）
            </div>

            <div id="workers_container">
                <div class="worker-entry" data-index="1">
                    <h4>受講者 1</h4>
                    <div class="inline-group">
                        <div class="form-group">
                            <label>氏名<span class="required">*</span></label>
                            <input type="text" id="worker_1_name" placeholder="例：佐藤 一郎">
                        </div>
                        <div class="form-group">
                            <label>フリガナ</label>
                            <input type="text" id="worker_1_name_kana" placeholder="例：サトウ イチロウ">
                        </div>
                    </div>
                    <div class="inline-group">
                        <div class="form-group">
                            <label>雇用保険被保険者番号</label>
                            <input type="text" id="worker_1_insurance_1" placeholder="1234" maxlength="4">
                        </div>
                        <div class="separator">-</div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <input type="text" id="worker_1_insurance_2" placeholder="567890" maxlength="6">
                        </div>
                        <div class="separator">-</div>
                        <div class="form-group" style="max-width:80px">
                            <label>&nbsp;</label>
                            <input type="text" id="worker_1_insurance_3" placeholder="1" maxlength="1">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>雇用形態</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" name="worker_1_type" id="worker_1_regular" value="regular" checked>
                                <label for="worker_1_regular">正規雇用労働者等</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="worker_1_type" id="worker_1_contract" value="contract">
                                <label for="worker_1_contract">有期契約労働者等</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <button class="btn-add-worker" onclick="addWorker()">+ 受講者を追加</button>

            <div class="btn-row">
                <button class="btn btn-secondary" onclick="prevStep()">← 戻る</button>
                <button class="btn btn-primary" onclick="nextStep()">次へ →</button>
            </div>
        </div>

        <!-- STEP 7: 経費情報 -->
        <div class="step-panel" id="step6">
            <h2>Step 7: 訓練経費の情報</h2>
            <p class="desc">訓練にかかる経費を入力してください（支給申請時に使用）</p>

            <div class="info-box">
                支給申請時に必要な情報です。まだ確定していない場合は概算で入力し、後で修正してください。
            </div>

            <div class="form-group">
                <label>計画届の受付番号
                    <span class="hint">計画届提出後に労働局から付与される番号。まだ未取得の場合は空欄でOK</span></label>
                <input type="text" id="plan_receipt_number" placeholder="例：1301-000000-0">
            </div>

            <hr class="section-divider">

            <div id="expense_internal" class="conditional">
                <h3 style="margin-bottom:15px; color:#1a5276">事業内訓練の経費</h3>
                <div class="inline-group">
                    <div class="form-group">
                        <label>部外講師の謝金・手当（円）</label>
                        <input type="number" id="instructor_fee" value="0">
                    </div>
                    <div class="form-group">
                        <label>部外講師の旅費（円）</label>
                        <input type="number" id="travel_fee" value="0">
                    </div>
                </div>
                <div class="inline-group">
                    <div class="form-group">
                        <label>施設・設備の借上げ費（円）</label>
                        <input type="number" id="facility_fee" value="0">
                    </div>
                    <div class="form-group">
                        <label>教材費・教科書代（円）</label>
                        <input type="number" id="material_fee" value="0">
                    </div>
                </div>
                <div class="form-group">
                    <label>訓練コースの開発費（円）</label>
                    <input type="number" id="development_fee" value="0">
                </div>
            </div>

            <div id="expense_external" class="conditional show">
                <h3 style="margin-bottom:15px; color:#1a5276">事業外訓練の経費</h3>
                <div class="form-group">
                    <label>入学料・受講料（円）<span class="required">*</span>
                        <span class="hint">教育訓練機関に支払う費用の合計</span></label>
                    <input type="number" id="tuition_fee" value="132000">
                </div>
            </div>

            <hr class="section-divider">

            <div class="form-group">
                <label>賃金助成の対象時間数（時間）
                    <span class="hint">所定労働時間内に実施した訓練の合計時間。通学制/同時双方向型の場合のみ</span></label>
                <input type="number" id="wage_subsidy_hours" value="10">
            </div>
            <div class="form-group" style="max-width:200px">
                <label>分</label>
                <input type="number" id="wage_subsidy_minutes" value="0" max="59">
            </div>

            <div class="btn-row">
                <button class="btn btn-secondary" onclick="prevStep()">← 戻る</button>
                <button class="btn btn-primary" onclick="nextStep()">次へ →</button>
            </div>
        </div>

        <!-- STEP 8: 確認・生成 -->
        <div class="step-panel" id="step7">
            <h2>Step 8: 確認と書類生成</h2>
            <p class="desc">入力内容を確認し、書類を生成してください</p>

            <div id="summary" style="background:#f8f9fa; border-radius:8px; padding:20px; margin-bottom:20px;">
                <h3 style="margin-bottom:15px">入力内容サマリー</h3>
                <div id="summary_content"></div>
            </div>

            <div class="info-box">
                「書類を生成する」ボタンを押すと、入力内容に基づいて全ての申請書類が自動生成されます。<br>
                生成される書類は元のExcelテンプレートと同じフォーマットです。
            </div>

            <div id="generate_section" style="text-align:center; margin:30px 0;">
                <button class="btn btn-success" onclick="generateDocuments()">書類を生成する</button>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>書類を生成しています...</p>
            </div>

            <div class="result-panel" id="result" style="display:none">
                <div class="icon">&#9989;</div>
                <h2>書類の生成が完了しました！</h2>
                <p id="result_message"></p>
                <div class="file-list" id="file_list"></div>
                <button class="btn btn-success" onclick="downloadFiles()">ダウンロード（ZIP）</button>
            </div>

            <div class="btn-row">
                <button class="btn btn-secondary" onclick="prevStep()">← 戻る</button>
                <div></div>
            </div>
        </div>
    </div>

    <div class="footer">
        人材開発支援助成金 書類作成ツール &mdash; Powered by if(塾)
    </div>

    <script>
    let currentStep = 0;
    const totalSteps = 8;
    let workerCount = 1;

    function goToStep(step) {
        if (step < 0 || step >= totalSteps) return;
        document.querySelectorAll('.step-panel').forEach(p => p.classList.remove('active'));
        document.getElementById('step' + step).classList.add('active');

        document.querySelectorAll('.progress-step').forEach((s, i) => {
            s.classList.remove('active');
            if (i < step) s.classList.add('completed');
            else s.classList.remove('completed');
            if (i === step) s.classList.add('active');
        });

        currentStep = step;
        window.scrollTo(0, 0);

        if (step === totalSteps - 1) updateSummary();
    }

    function nextStep() { goToStep(currentStep + 1); }
    function prevStep() { goToStep(currentStep - 1); }

    function addWorker() {
        workerCount++;
        const container = document.getElementById('workers_container');
        const entry = document.createElement('div');
        entry.className = 'worker-entry';
        entry.dataset.index = workerCount;
        const n = workerCount;
        entry.innerHTML = `
            <h4>受講者 ${n} <button class="btn-remove" onclick="removeWorker(this)">削除</button></h4>
            <div class="inline-group">
                <div class="form-group">
                    <label>氏名</label>
                    <input type="text" id="worker_${n}_name">
                </div>
                <div class="form-group">
                    <label>フリガナ</label>
                    <input type="text" id="worker_${n}_name_kana">
                </div>
            </div>
            <div class="inline-group">
                <div class="form-group">
                    <label>雇用保険被保険者番号</label>
                    <input type="text" id="worker_${n}_insurance_1" maxlength="4">
                </div>
                <div class="separator">-</div>
                <div class="form-group">
                    <label>&nbsp;</label>
                    <input type="text" id="worker_${n}_insurance_2" maxlength="6">
                </div>
                <div class="separator">-</div>
                <div class="form-group" style="max-width:80px">
                    <label>&nbsp;</label>
                    <input type="text" id="worker_${n}_insurance_3" maxlength="1">
                </div>
            </div>
            <div class="form-group">
                <label>雇用形態</label>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" name="worker_${n}_type" id="worker_${n}_regular" value="regular" checked>
                        <label for="worker_${n}_regular">正規雇用労働者等</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="worker_${n}_type" id="worker_${n}_contract" value="contract">
                        <label for="worker_${n}_contract">有期契約労働者等</label>
                    </div>
                </div>
            </div>`;
        container.appendChild(entry);
    }

    function removeWorker(btn) {
        btn.closest('.worker-entry').remove();
    }

    // 条件分岐の表示制御
    function setupConditionals() {
        // 法人/個人事業主 切替
        document.querySelectorAll('input[name="applicant_type"]').forEach(r => {
            r.addEventListener('change', () => {
                const isCorp = document.getElementById('applicant_corp').checked;
                document.getElementById('corporate_number_group').classList.toggle('show', isCorp);
                if (isCorp) {
                    document.getElementById('company_name_label').textContent = '事業主 名称（会社名）';
                    document.getElementById('company_name').placeholder = '例：株式会社○○';
                    document.getElementById('rep_title_label').textContent = '代表者 役職名';
                    document.getElementById('representative_title').placeholder = '例：代表取締役';
                } else {
                    document.getElementById('company_name_label').textContent = '屋号（あれば）';
                    document.getElementById('company_name').placeholder = '例：○○事務所（なければ空欄でOK）';
                    document.getElementById('rep_title_label').textContent = '肩書（あれば）';
                    document.getElementById('representative_title').placeholder = '例：代表（なければ空欄でOK）';
                }
            });
        });

        // 代理人
        document.querySelectorAll('input[name="has_agent"]').forEach(r => {
            r.addEventListener('change', () => {
                document.getElementById('agent_section').classList.toggle('show',
                    document.getElementById('has_agent_yes').checked);
            });
        });

        // 定額制サービス
        document.querySelectorAll('input[name="is_subscription"]').forEach(r => {
            r.addEventListener('change', () => {
                document.getElementById('subscription_section').classList.toggle('show',
                    document.getElementById('sub_yes').checked);
            });
        });

        // 訓練方法
        document.querySelectorAll('input[name="training_method"]').forEach(r => {
            r.addEventListener('change', () => {
                const method = document.querySelector('input[name="training_method"]:checked').value;
                document.getElementById('hours_classroom').classList.toggle('show', method === '1' || method === '2');
                document.getElementById('hours_elearning').classList.toggle('show', method === '3' || method === '4');
            });
        });

        // 資格試験
        document.querySelectorAll('input[name="has_exam"]').forEach(r => {
            r.addEventListener('change', () => {
                document.getElementById('exam_section').classList.toggle('show',
                    document.getElementById('exam_yes').checked);
            });
        });

        // 助成区分 → 事業展開計画の表示切替
        document.querySelectorAll('input[name="subsidy_type"]').forEach(r => {
            r.addEventListener('change', () => {
                const type = document.querySelector('input[name="subsidy_type"]:checked').value;
                document.getElementById('expansion_content_group').style.display = type === '1' ? 'block' : 'none';
                document.getElementById('dx_content_group').style.display = type !== '1' ? 'block' : 'none';
            });
        });

        // OFF-JT種別
        document.querySelectorAll('input[name="offjt_type"]').forEach(r => {
            r.addEventListener('change', () => {
                const type = document.querySelector('input[name="offjt_type"]:checked').value;
                document.getElementById('internal_instructor').classList.toggle('show', type === '1' || type === '2');
                document.getElementById('external_training').classList.toggle('show', type === '2' || type === '3');
                document.getElementById('expense_internal').classList.toggle('show', type === '1' || type === '2');
                document.getElementById('expense_external').classList.toggle('show', type === '3');
            });
        });

        // 初期表示（デフォルト：同時双方向型・DX化・事業外訓練）
        document.getElementById('hours_classroom').classList.add('show');
        // DX化がデフォルトなので事業展開内容を非表示、DX内容を表示
        document.getElementById('expansion_content_group').style.display = 'none';
        document.getElementById('dx_content_group').style.display = 'block';
    }

    function collectData() {
        const data = {};
        // テキスト・数値フィールド
        const fields = [
            'submit_year', 'submit_month', 'submit_day', 'labor_bureau',
            'postal_code_1', 'postal_code_2', 'company_address', 'company_name',
            'representative_title', 'representative_name', 'corporate_number',
            'agent_postal_1', 'agent_postal_2', 'agent_address', 'agent_name_org',
            'agent_name_person', 'agent_phone_1', 'agent_phone_2', 'agent_phone_3',
            'office_name', 'office_number_1', 'office_number_2', 'office_number_3',
            'office_postal_1', 'office_postal_2', 'office_address',
            'contact_name', 'contact_dept', 'contact_phone_1', 'contact_phone_2',
            'contact_phone_3', 'contact_email', 'total_employees', 'main_business',
            'course_name', 'num_trainees',
            'training_start_year', 'training_start_month', 'training_start_day',
            'training_end_year', 'training_end_month', 'training_end_day',
            'contract_start_year', 'contract_start_month', 'contract_start_day',
            'contract_end_year', 'contract_end_month', 'contract_end_day',
            'total_subscribers',
            'total_hours', 'total_minutes', 'offjt_hours', 'offjt_minutes',
            'standard_hours', 'standard_minutes',
            'exam_name', 'exam_year', 'exam_month', 'exam_day',
            'expansion_year', 'expansion_month', 'expansion_content', 'dx_content',
            'training_location', 'instructor_name', 'instructor_dept',
            'instructor_title', 'instructor_duties',
            'training_org_name', 'training_org_rep', 'training_org_address',
            'training_org_corp_number',
            'plan_receipt_number',
            'instructor_fee', 'travel_fee', 'facility_fee', 'material_fee',
            'development_fee', 'tuition_fee',
            'wage_subsidy_hours', 'wage_subsidy_minutes',
        ];

        fields.forEach(f => {
            const el = document.getElementById(f);
            if (el) data[f] = el.value;
        });

        // ラジオボタン
        const radios = [
            'applicant_type', 'has_agent', 'agent_type', 'is_sme', 'subsidy_type', 'is_subscription',
            'training_method', 'has_exam', 'auto_renewal', 'offjt_type', 'contract_reason'
        ];
        radios.forEach(r => {
            const el = document.querySelector(`input[name="${r}"]:checked`);
            if (el) data[r] = el.value;
        });

        // 労働者データ
        document.querySelectorAll('.worker-entry').forEach(entry => {
            const idx = entry.dataset.index;
            ['name', 'name_kana', 'insurance_1', 'insurance_2', 'insurance_3'].forEach(f => {
                const el = document.getElementById(`worker_${idx}_${f}`);
                if (el) data[`worker_${idx}_${f}`] = el.value;
            });
            const typeEl = document.querySelector(`input[name="worker_${idx}_type"]:checked`);
            if (typeEl) data[`worker_${idx}_type`] = typeEl.value;
        });

        return data;
    }

    function updateSummary() {
        const data = collectData();
        const subsTypes = {'1': '事業展開に伴い実施する訓練', '2': 'DX化に伴い実施する訓練', '3': 'グリーン・カーボンニュートラル化'};
        const methods = {'1': '通学制', '2': '同時双方向型', '3': 'eラーニング', '4': '通信制'};
        const offjts = {'1': '事業内（部内講師）', '2': '事業内（部外講師）', '3': '事業外訓練'};

        let html = `
            <table style="width:100%; border-collapse:collapse;">
                <tr><td style="padding:5px; font-weight:bold; width:180px">事業主</td><td>${data.company_name || '-'}</td></tr>
                <tr><td style="padding:5px; font-weight:bold">所在地</td><td>〒${data.postal_code_1}-${data.postal_code_2} ${data.company_address || ''}</td></tr>
                <tr><td style="padding:5px; font-weight:bold">代表者</td><td>${data.representative_title} ${data.representative_name}</td></tr>
                <tr><td style="padding:5px; font-weight:bold">申請者種別</td><td>${data.applicant_type === 'corporate' ? '法人' : '個人事業主'}</td></tr>
                ${data.applicant_type === 'corporate' ? `<tr><td style="padding:5px; font-weight:bold">法人番号</td><td>${data.corporate_number || '（未入力）'}</td></tr>` : ''}
                <tr><td colspan="2" style="padding:8px 0; border-top:1px solid #ddd"></td></tr>
                <tr><td style="padding:5px; font-weight:bold">事業所名</td><td>${data.office_name || '-'}</td></tr>
                <tr><td style="padding:5px; font-weight:bold">事業所番号</td><td>${data.office_number_1}-${data.office_number_2}-${data.office_number_3}</td></tr>
                <tr><td style="padding:5px; font-weight:bold">担当者</td><td>${data.contact_name || '-'}</td></tr>
                <tr><td colspan="2" style="padding:8px 0; border-top:1px solid #ddd"></td></tr>
                <tr><td style="padding:5px; font-weight:bold">助成区分</td><td>${subsTypes[data.subsidy_type] || '-'}</td></tr>
                <tr><td style="padding:5px; font-weight:bold">訓練コース名</td><td>${data.course_name || '-'}</td></tr>
                <tr><td style="padding:5px; font-weight:bold">受講者数</td><td>${data.num_trainees || '-'}名</td></tr>
                <tr><td style="padding:5px; font-weight:bold">訓練期間</td><td>${data.training_start_year}/${data.training_start_month}/${data.training_start_day} ～ ${data.training_end_year}/${data.training_end_month}/${data.training_end_day}</td></tr>
                <tr><td style="padding:5px; font-weight:bold">実施方法</td><td>${methods[data.training_method] || '-'}</td></tr>
                <tr><td style="padding:5px; font-weight:bold">OFF-JT種別</td><td>${offjts[data.offjt_type] || '-'}</td></tr>
                <tr><td style="padding:5px; font-weight:bold">定額制サービス</td><td>${data.is_subscription === 'yes' ? 'はい' : 'いいえ'}</td></tr>
            </table>`;
        document.getElementById('summary_content').innerHTML = html;
    }

    async function generateDocuments() {
        const data = collectData();
        document.getElementById('generate_section').style.display = 'none';
        document.getElementById('loading').style.display = 'block';

        try {
            // まずJSONレスポンスで生成結果を取得（ファイル一覧表示用）
            const response = await fetch('/generate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            const result = await response.json();
            document.getElementById('loading').style.display = 'none';

            if (result.success) {
                document.getElementById('result').style.display = 'block';
                document.getElementById('result_message').textContent = result.message;
                const fileList = document.getElementById('file_list');
                fileList.innerHTML = '<ul>' + result.files.map(f => `<li>${f}</li>`).join('') + '</ul>';
                // ダウンロード用のデータを保持
                window._generatedData = data;
            } else {
                alert('エラーが発生しました: ' + (result.error || '不明なエラー'));
                document.getElementById('generate_section').style.display = 'block';
            }
        } catch (e) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('generate_section').style.display = 'block';
            alert('通信エラーが発生しました: ' + e.message);
        }
    }

    async function downloadFiles() {
        try {
            // Vercel serverless対応: 生成とダウンロードを1リクエストで実行
            const data = window._generatedData || collectData();
            const response = await fetch('/generate_and_download', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            if (!response.ok) {
                // フォールバック: 従来の/downloadエンドポイント
                window.location.href = '/download';
                return;
            }

            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = '人材開発支援助成金_申請書類一式.zip';
            document.body.appendChild(a);
            a.click();
            a.remove();
            window.URL.revokeObjectURL(url);
        } catch (e) {
            // フォールバック
            window.location.href = '/download';
        }
    }

    // 初期化
    setupConditionals();
    </script>
</body>
</html>
